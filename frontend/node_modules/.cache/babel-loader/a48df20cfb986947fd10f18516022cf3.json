{"ast":null,"code":"import _toConsumableArray from\"/Users/mike/Desktop/Code/Projects/Diploma/movies-explorer-frontend/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"/Users/mike/Desktop/Code/Projects/Diploma/movies-explorer-frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import MoviesCardList from\"./MoviesCardList/MoviesCardList\";import SearchForm from\"./SearchForm/SearchForm\";import Header from\"../Header/Header\";import Footer from\"../Footer/Footer\";import{filterMovies,filterCheckedMovies}from\"../../utils/moviesFilter\";import{useEffect,useState}from\"react\";import mainApi from\"../../utils/MainApi\";import moviesApi from\"../../utils/MoviesApi\";import useWindowSize from\"../../utils/useWindowSize\";import{SmallDisplay,MediumDisplay,LargeDisplay}from\"../../utils/constants\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var token=localStorage.getItem(\"token\");var getSortedMovies=function getSortedMovies(movies,query,isShort){var savedMoviesKey=\"savedMovies\";var savedMoviesInLocalStorage=localStorage.getItem(savedMoviesKey);var savedMovies=savedMoviesInLocalStorage?JSON.parse(savedMoviesInLocalStorage):[];var savedByQuery=savedMovies.find(function(item){return item.query===query&&item.isShort===isShort;});if(savedByQuery&&savedByQuery.list.length!==0){return savedByQuery.list;}var moviesFormAPI=isShort?filterCheckedMovies(movies,query):filterMovies(movies,query);localStorage.setItem(savedMoviesKey,JSON.stringify([{query:query,isShort:isShort,list:moviesFormAPI}]));return moviesFormAPI;};var Movies=function Movies(_ref){var onLoading=_ref.onLoading,isSubmitting=_ref.isSubmitting,loggedIn=_ref.loggedIn;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),movies=_useState2[0],setMovies=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),sortedMovies=_useState4[0],setSortedMovies=_useState4[1];var _useState5=useState(localStorage.getItem(\"isShort\")===true),_useState6=_slicedToArray(_useState5,2),isChecked=_useState6[0],setIsChecked=_useState6[1];var _useState7=useState(true),_useState8=_slicedToArray(_useState7,2),isThereSortetMovies=_useState8[0],setIsThereSortedMovies=_useState8[1];var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),savedMovies=_useState10[0],setSavedMovies=_useState10[1];var _useState11=useState(localStorage.getItem(\"query\")||\"\"),_useState12=_slicedToArray(_useState11,2),searchText=_useState12[0],setSearchText=_useState12[1];var _useState13=useState(0),_useState14=_slicedToArray(_useState13,2),visible=_useState14[0],setVisible=_useState14[1];var _useWindowSize=useWindowSize(),_useWindowSize2=_slicedToArray(_useWindowSize,1),windowWidth=_useWindowSize2[0];useEffect(function(){if(loggedIn){Promise.all([mainApi.getSavedMovies(token),moviesApi.getAllMovies()]).then(function(data){var _data=_slicedToArray(data,2),savedMovies=_data[0],allMovies=_data[1];setIsThereSortedMovies(true);setSavedMovies(savedMovies.movies);setMovies(allMovies);}).catch(function(err){console.log(err);});}},[loggedIn]);useEffect(function(){var sortedMoviesByQuery=getSortedMovies(movies,searchText,isChecked);if(sortedMoviesByQuery.length!==0){setSortedMovies(sortedMoviesByQuery);}else{setSortedMovies(sortedMoviesByQuery);setIsThereSortedMovies(false);}localStorage.setItem(\"query\",searchText);localStorage.setItem(\"isShort\",isChecked);},[isChecked,searchText,movies]);function handleCheckboxBtnClicked(){setIsChecked(!isChecked);}function handleBookmarkMovieStatus(movie){var isBookmark=savedMovies.some(function(item){return item.nameRU===movie.nameRU;});if(!isBookmark){mainApi.createMovie(movie,token).then(function(movie){setSavedMovies([movie].concat(_toConsumableArray(savedMovies)));}).catch(function(err){console.log(err);});}else{var currentSavedMovie=savedMovies.filter(function(item){return item.nameRU===movie.nameRU;});mainApi.deleteMovie(currentSavedMovie[0]._id,token).then(function(){setSavedMovies(function(state){return state.filter(function(k){return k._id!==currentSavedMovie[0]._id;});});}).catch(function(err){console.log(err);});}}useEffect(function(){if(windowWidth>768){return setVisible(LargeDisplay);}else if(windowWidth<=768&&windowWidth>321){return setVisible(MediumDisplay);}else if(windowWidth<=320){return setVisible(SmallDisplay);}},[windowWidth]);function handleAddMoreBtnClick(){if(windowWidth>768){setVisible(visible+3);}else if(windowWidth<=768){setVisible(visible+2);}}return/*#__PURE__*/_jsxs(\"div\",{className:\"movies\",children:[/*#__PURE__*/_jsx(Header,{loggedIn:loggedIn}),/*#__PURE__*/_jsx(SearchForm,{searchText:searchText,onSearchText:setSearchText,onChecked:handleCheckboxBtnClicked,onLoading:onLoading,isChecked:isChecked}),/*#__PURE__*/_jsx(MoviesCardList,{movies:sortedMovies,visible:visible,loadMore:handleAddMoreBtnClick,isSubmitting:isSubmitting,onHandleBookmark:handleBookmarkMovieStatus,savedMovies:savedMovies,isThereSortetMovies:isThereSortetMovies}),/*#__PURE__*/_jsx(Footer,{})]});};export default Movies;","map":{"version":3,"names":["MoviesCardList","SearchForm","Header","Footer","filterMovies","filterCheckedMovies","useEffect","useState","mainApi","moviesApi","useWindowSize","SmallDisplay","MediumDisplay","LargeDisplay","token","localStorage","getItem","getSortedMovies","movies","query","isShort","savedMoviesKey","savedMoviesInLocalStorage","savedMovies","JSON","parse","savedByQuery","find","item","list","length","moviesFormAPI","setItem","stringify","Movies","onLoading","isSubmitting","loggedIn","setMovies","sortedMovies","setSortedMovies","isChecked","setIsChecked","isThereSortetMovies","setIsThereSortedMovies","setSavedMovies","searchText","setSearchText","visible","setVisible","windowWidth","Promise","all","getSavedMovies","getAllMovies","then","data","allMovies","catch","err","console","log","sortedMoviesByQuery","handleCheckboxBtnClicked","handleBookmarkMovieStatus","movie","isBookmark","some","nameRU","createMovie","currentSavedMovie","filter","deleteMovie","_id","state","k","handleAddMoreBtnClick"],"sources":["/Users/mike/Desktop/Code/Projects/Diploma/movies-explorer-frontend/src/components/Movies/Movies.js"],"sourcesContent":["import MoviesCardList from \"./MoviesCardList/MoviesCardList\";\nimport SearchForm from \"./SearchForm/SearchForm\";\nimport Header from \"../Header/Header\";\nimport Footer from \"../Footer/Footer\";\nimport { filterMovies, filterCheckedMovies } from \"../../utils/moviesFilter\";\nimport { useEffect, useState } from \"react\";\nimport mainApi from \"../../utils/MainApi\";\nimport moviesApi from \"../../utils/MoviesApi\";\nimport useWindowSize from \"../../utils/useWindowSize\";\nimport {\n  SmallDisplay,\n  MediumDisplay,\n  LargeDisplay,\n} from \"../../utils/constants\";\n\nconst token = localStorage.getItem(\"token\");\n\nconst getSortedMovies = (movies, query, isShort) => {\n  const savedMoviesKey = \"savedMovies\";\n  const savedMoviesInLocalStorage = localStorage.getItem(savedMoviesKey);\n  const savedMovies = savedMoviesInLocalStorage\n    ? JSON.parse(savedMoviesInLocalStorage)\n    : [];\n\n  const savedByQuery = savedMovies.find(\n    (item) => item.query === query && item.isShort === isShort\n  );\n\n  if (savedByQuery && savedByQuery.list.length !== 0) {\n    return savedByQuery.list;\n  }\n\n  const moviesFormAPI = isShort\n    ? filterCheckedMovies(movies, query)\n    : filterMovies(movies, query);\n\n  localStorage.setItem(\n    savedMoviesKey,\n    JSON.stringify([{ query, isShort, list: moviesFormAPI }])\n  );\n\n  return moviesFormAPI;\n};\n\nconst Movies = ({ onLoading, isSubmitting, loggedIn }) => {\n  const [movies, setMovies] = useState([]);\n  const [sortedMovies, setSortedMovies] = useState([]);\n  const [isChecked, setIsChecked] = useState(\n    localStorage.getItem(\"isShort\") === true\n  );\n  const [isThereSortetMovies, setIsThereSortedMovies] = useState(true);\n  const [savedMovies, setSavedMovies] = useState([]);\n  const [searchText, setSearchText] = useState(\n    localStorage.getItem(\"query\") || \"\"\n  );\n  const [visible, setVisible] = useState(0);\n  const [windowWidth] = useWindowSize();\n\n  useEffect(() => {\n    if (loggedIn) {\n      Promise.all([mainApi.getSavedMovies(token), moviesApi.getAllMovies()])\n        .then((data) => {\n          const [savedMovies, allMovies] = data;\n          setIsThereSortedMovies(true);\n          setSavedMovies(savedMovies.movies);\n          setMovies(allMovies);\n        })\n        .catch((err) => {\n          console.log(err);\n        });\n    }\n  }, [loggedIn]);\n\n  useEffect(() => {\n    const sortedMoviesByQuery = getSortedMovies(movies, searchText, isChecked);\n\n    if (sortedMoviesByQuery.length !== 0) {\n      setSortedMovies(sortedMoviesByQuery);\n    } else {\n      setSortedMovies(sortedMoviesByQuery);\n      setIsThereSortedMovies(false);\n    }\n\n    localStorage.setItem(\"query\", searchText);\n    localStorage.setItem(\"isShort\", isChecked);\n  }, [isChecked, searchText, movies]);\n\n  function handleCheckboxBtnClicked() {\n    setIsChecked(!isChecked);\n  }\n\n  function handleBookmarkMovieStatus(movie) {\n    const isBookmark = savedMovies.some((item) => item.nameRU === movie.nameRU);\n    if (!isBookmark) {\n      mainApi\n        .createMovie(movie, token)\n        .then((movie) => {\n          setSavedMovies([movie, ...savedMovies]);\n        })\n        .catch((err) => {\n          console.log(err);\n        });\n    } else {\n      const currentSavedMovie = savedMovies.filter(\n        (item) => item.nameRU === movie.nameRU\n      );\n      mainApi\n        .deleteMovie(currentSavedMovie[0]._id, token)\n        .then(() => {\n          setSavedMovies((state) =>\n            state.filter((k) => k._id !== currentSavedMovie[0]._id)\n          );\n        })\n        .catch((err) => {\n          console.log(err);\n        });\n    }\n  }\n\n  useEffect(() => {\n    if (windowWidth > 768) {\n      return setVisible(LargeDisplay);\n    } else if (windowWidth <= 768 && windowWidth > 321) {\n      return setVisible(MediumDisplay);\n    } else if (windowWidth <= 320) {\n      return setVisible(SmallDisplay);\n    }\n  }, [windowWidth]);\n\n  function handleAddMoreBtnClick() {\n    if (windowWidth > 768) {\n      setVisible(visible + 3);\n    } else if (windowWidth <= 768) {\n      setVisible(visible + 2);\n    }\n  }\n\n  return (\n    <div className=\"movies\">\n      <Header loggedIn={loggedIn} />\n      <SearchForm\n        searchText={searchText}\n        onSearchText={setSearchText}\n        onChecked={handleCheckboxBtnClicked}\n        onLoading={onLoading}\n        isChecked={isChecked}\n      />\n      <MoviesCardList\n        movies={sortedMovies}\n        visible={visible}\n        loadMore={handleAddMoreBtnClick}\n        isSubmitting={isSubmitting}\n        onHandleBookmark={handleBookmarkMovieStatus}\n        savedMovies={savedMovies}\n        isThereSortetMovies={isThereSortetMovies}\n      />\n      <Footer />\n    </div>\n  );\n};\n\nexport default Movies;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}