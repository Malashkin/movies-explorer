{"ast":null,"code":"import _slicedToArray from\"/Users/mike/Desktop/Code/Projects/Diploma/movies-explorer-frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";/* eslint-disable react-hooks/exhaustive-deps */ /* eslint-disable no-underscore-dangle */import React,{useState,useEffect}from\"react\";import{Route,Switch,useHistory}from\"react-router-dom\";import Main from\"../Main/Main\";import Movies from\"../Movies/Movies\";import SaveMovies from\"../SavedMovies/SavedMovies\";import Profile from\"../Profile/Profile\";import Login from\"../Login/Login\";import Register from\"../Register/Register\";import NotFoundPage from\"../NotFoundPage/NotFoundPage\";import mainApi from\"../../utils/MainApi\";import{CurrentUserContext}from\"../../contexts/CurrentUserContext\";import ProtectedRoute from\"../ProtectedRoute/ProtectedRoute\";import{CONFLICT_ERROR,UNAUTHORIZED_ERROR}from\"../../utils/constants\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function App(){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),loggedIn=_useState2[0],setLoggedIn=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),currentUser=_useState4[0],setCurrentUser=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),errorStatus=_useState6[0],setErrorStatus=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),errorText=_useState8[0],setErrorText=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),successStatus=_useState10[0],setSuccessStatus=_useState10[1];var history=useHistory();var _useState11=useState(\"\"),_useState12=_slicedToArray(_useState11,2),token=_useState12[0],setToken=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),isSubmitting=_useState14[0],setIsSubmitting=_useState14[1];useEffect(function(){function tokenCheck(){if(localStorage.getItem(\"token\")){var _token=localStorage.getItem(\"token\");if(_token){setLoggedIn(true);history.push(\"/movies\");setToken(localStorage.getItem(\"token\"));mainApi.getUserInfo(_token).then(function(data){setCurrentUser(data);});}}}tokenCheck();},[history,token]);function makeLogin(email,password){mainApi.makeSignIn(email,password).then(function(res){if(res.token){localStorage.setItem(\"token\",res.token);setToken(localStorage.getItem(\"token\"));var _token2=localStorage.getItem(\"token\");mainApi.getUserInfo(_token2).then(function(data){setCurrentUser(data);setLoggedIn(true);history.push(\"/movies\");console.log(currentUser);});}}).catch(function(err){if(err.status===UNAUTHORIZED_ERROR){setErrorStatus(true);setErrorText(\"Вы ввели неправильный логин или пароль.\");}});}function makeRegister(name,email,password){mainApi.makeSignUp(name,email,password).then(function(data){setCurrentUser(data);makeLogin(email,password);}).catch(function(err){if(err.status===CONFLICT_ERROR){setErrorStatus(true);setErrorText(\"Пользователь с таким email уже зарегистрирован\");}else{setErrorStatus(true);setErrorText(\"При регистрации произошла ошибка\");}});}function handleProfileSubmit(name,email){mainApi.updateUserInfo(name,email,token).then(function(data){setCurrentUser(data.data);setSuccessStatus(true);}).catch(function(err){console.log(err);setErrorStatus(true);setErrorText(\"При обновлении профиля произошла ошибка.\");});}function handleSignOut(){localStorage.removeItem(\"token\");setLoggedIn(false);localStorage.removeItem(\"savedMovies\");localStorage.removeItem(\"query\");localStorage.removeItem(\"isShort\");history.push(\"/\");}function renderLoading(isLoading){setIsSubmitting(isLoading);}return/*#__PURE__*/_jsx(\"div\",{className:\"page\",children:/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsx(Route,{path:\"/sign-in\",children:/*#__PURE__*/_jsx(Register,{errorStatus:errorStatus,setErrorStatus:setErrorStatus,errorText:errorText,onSubmit:makeRegister})}),/*#__PURE__*/_jsx(Route,{path:\"/sign-up\",children:/*#__PURE__*/_jsx(Login,{errorStatus:errorStatus,setErrorStatus:setErrorStatus,errorText:errorText,onSubmit:makeLogin})}),/*#__PURE__*/_jsx(Route,{exact:true,path:\"/\",children:/*#__PURE__*/_jsx(Main,{loggedIn:loggedIn})}),/*#__PURE__*/_jsx(CurrentUserContext.Provider,{value:currentUser,children:/*#__PURE__*/_jsxs(ProtectedRoute,{loggedIn:loggedIn,children:[/*#__PURE__*/_jsx(Route,{path:\"/movies\",children:/*#__PURE__*/_jsx(Movies,{loggedIn:loggedIn,isSubmitting:isSubmitting,onLoading:renderLoading})}),/*#__PURE__*/_jsx(Route,{path:\"/saved-movies\",children:/*#__PURE__*/_jsx(SaveMovies,{loggedIn:loggedIn,isSubmitting:isSubmitting,onLoading:renderLoading})}),/*#__PURE__*/_jsx(Route,{path:\"/profile\",children:/*#__PURE__*/_jsx(Profile,{loggedIn:loggedIn,onProfileSubmit:handleProfileSubmit,onSignOut:handleSignOut,errorStatus:errorStatus,errorText:errorText,successStatus:successStatus,setSuccessStatus:setSuccessStatus})})]})}),/*#__PURE__*/_jsx(Route,{path:\"*\",children:/*#__PURE__*/_jsx(NotFoundPage,{})})]})});}export default App;","map":{"version":3,"names":["React","useState","useEffect","Route","Switch","useHistory","Main","Movies","SaveMovies","Profile","Login","Register","NotFoundPage","mainApi","CurrentUserContext","ProtectedRoute","CONFLICT_ERROR","UNAUTHORIZED_ERROR","App","loggedIn","setLoggedIn","currentUser","setCurrentUser","errorStatus","setErrorStatus","errorText","setErrorText","successStatus","setSuccessStatus","history","token","setToken","isSubmitting","setIsSubmitting","tokenCheck","localStorage","getItem","push","getUserInfo","then","data","makeLogin","email","password","makeSignIn","res","setItem","console","log","catch","err","status","makeRegister","name","makeSignUp","handleProfileSubmit","updateUserInfo","handleSignOut","removeItem","renderLoading","isLoading"],"sources":["/Users/mike/Desktop/Code/Projects/Diploma/movies-explorer-frontend/src/components/App/App.js"],"sourcesContent":["/* eslint-disable react-hooks/exhaustive-deps */\n/* eslint-disable no-underscore-dangle */\nimport React, { useState, useEffect } from \"react\";\nimport { Route, Switch, useHistory } from \"react-router-dom\";\nimport Main from \"../Main/Main\";\nimport Movies from \"../Movies/Movies\";\nimport SaveMovies from \"../SavedMovies/SavedMovies\";\nimport Profile from \"../Profile/Profile\";\nimport Login from \"../Login/Login\";\nimport Register from \"../Register/Register\";\nimport NotFoundPage from \"../NotFoundPage/NotFoundPage\";\nimport mainApi from \"../../utils/MainApi\";\nimport { CurrentUserContext } from \"../../contexts/CurrentUserContext\";\nimport ProtectedRoute from \"../ProtectedRoute/ProtectedRoute\";\nimport { CONFLICT_ERROR, UNAUTHORIZED_ERROR } from \"../../utils/constants\";\n\nfunction App() {\n  const [loggedIn, setLoggedIn] = useState(false);\n  const [currentUser, setCurrentUser] = useState(\"\");\n  const [errorStatus, setErrorStatus] = useState(false);\n  const [errorText, setErrorText] = useState(\"\");\n  const [successStatus, setSuccessStatus] = useState(false);\n  const history = useHistory();\n  const [token, setToken] = useState(\"\");\n  const [isSubmitting, setIsSubmitting] = useState(false);\n\n  useEffect(() => {\n    function tokenCheck() {\n      if (localStorage.getItem(\"token\")) {\n        const token = localStorage.getItem(\"token\");\n        if (token) {\n          setLoggedIn(true);\n          history.push(\"/movies\");\n          setToken(localStorage.getItem(\"token\"));\n          mainApi.getUserInfo(token).then((data) => {\n            setCurrentUser(data);\n          });\n        }\n      }\n    }\n    tokenCheck();\n  }, [history, token]);\n\n  function makeLogin(email, password) {\n    mainApi\n      .makeSignIn(email, password)\n      .then((res) => {\n        if (res.token) {\n          localStorage.setItem(\"token\", res.token);\n          setToken(localStorage.getItem(\"token\"));\n          const token = localStorage.getItem(\"token\");\n          mainApi.getUserInfo(token).then((data) => {\n            setCurrentUser(data);\n            setLoggedIn(true);\n            history.push(\"/movies\");\n            console.log(currentUser);\n          });\n        }\n      })\n      .catch((err) => {\n        if (err.status === UNAUTHORIZED_ERROR) {\n          setErrorStatus(true);\n          setErrorText(\"Вы ввели неправильный логин или пароль.\");\n        }\n      });\n  }\n\n  function makeRegister(name, email, password) {\n    mainApi\n      .makeSignUp(name, email, password)\n      .then((data) => {\n        setCurrentUser(data);\n        makeLogin(email, password);\n      })\n      .catch((err) => {\n        if (err.status === CONFLICT_ERROR) {\n          setErrorStatus(true);\n          setErrorText(\"Пользователь с таким email уже зарегистрирован\");\n        } else {\n          setErrorStatus(true);\n          setErrorText(\"При регистрации произошла ошибка\");\n        }\n      });\n  }\n\n  function handleProfileSubmit(name, email) {\n    mainApi\n      .updateUserInfo(name, email, token)\n      .then((data) => {\n        setCurrentUser(data.data);\n        setSuccessStatus(true);\n      })\n      .catch((err) => {\n        console.log(err);\n        setErrorStatus(true);\n        setErrorText(\"При обновлении профиля произошла ошибка.\");\n      });\n  }\n\n  function handleSignOut() {\n    localStorage.removeItem(\"token\");\n    setLoggedIn(false);\n    localStorage.removeItem(\"savedMovies\");\n    localStorage.removeItem(\"query\");\n    localStorage.removeItem(\"isShort\");\n    history.push(\"/\");\n  }\n\n  function renderLoading(isLoading) {\n    setIsSubmitting(isLoading);\n  }\n\n  return (\n    <div className=\"page\">\n      <Switch>\n        <Route path=\"/sign-in\">\n          <Register\n            errorStatus={errorStatus}\n            setErrorStatus={setErrorStatus}\n            errorText={errorText}\n            onSubmit={makeRegister}\n          />\n        </Route>\n        <Route path=\"/sign-up\">\n          <Login\n            errorStatus={errorStatus}\n            setErrorStatus={setErrorStatus}\n            errorText={errorText}\n            onSubmit={makeLogin}\n          />\n        </Route>\n        <Route exact path=\"/\">\n          <Main loggedIn={loggedIn} />\n        </Route>\n        <CurrentUserContext.Provider value={currentUser}>\n          <ProtectedRoute loggedIn={loggedIn}>\n            <Route path=\"/movies\">\n              <Movies\n                loggedIn={loggedIn}\n                isSubmitting={isSubmitting}\n                onLoading={renderLoading}\n              />\n            </Route>\n            <Route path=\"/saved-movies\">\n              <SaveMovies\n                loggedIn={loggedIn}\n                isSubmitting={isSubmitting}\n                onLoading={renderLoading}\n              />\n            </Route>\n            <Route path=\"/profile\">\n              <Profile\n                loggedIn={loggedIn}\n                onProfileSubmit={handleProfileSubmit}\n                onSignOut={handleSignOut}\n                errorStatus={errorStatus}\n                errorText={errorText}\n                successStatus={successStatus}\n                setSuccessStatus={setSuccessStatus}\n              />\n            </Route>\n          </ProtectedRoute>\n        </CurrentUserContext.Provider>\n        <Route path=\"*\">\n          <NotFoundPage />\n        </Route>\n      </Switch>\n    </div>\n  );\n}\n\nexport default App;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}